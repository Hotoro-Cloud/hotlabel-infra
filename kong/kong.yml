_format_version: "2.1"

services:
  # Publisher Management Service
  - name: publishers-service
    url: http://publishers:8000/api/v1
    routes:
      - name: publishers-route
        paths:
          - /api/v1/publishers
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - PATCH
            - DELETE
            - OPTIONS
          headers:
            - Content-Type
            - Authorization
            - X-Requested-With
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

  # Task Management Service
  - name: tasks-service
    url: http://tasks:8000/api/v1
    routes:
      - name: tasks-route
        paths:
          - /api/v1/tasks
          - /api/v1/assignments
          - /api/v1/results
          - /api/v1/ingestion
          - /api/v1/admin
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - PATCH
            - DELETE
            - OPTIONS
          headers:
            - Content-Type
            - Authorization
            - X-Requested-With
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

  # Quality Assurance Service
  - name: qa-service
    url: http://qa:8000/api/v1
    routes:
      - name: qa-route
        paths:
          - /api/v1/quality
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - PATCH
            - DELETE
            - OPTIONS
          headers:
            - Content-Type
            - Authorization
            - X-Requested-With
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

  # User Profiling Service
  - name: users-service
    url: http://users:8000/api/v1
    routes:
      - name: users-route
        paths:
          - /api/v1/users
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - PATCH
            - DELETE
            - OPTIONS
          headers:
            - Content-Type
            - Authorization
            - X-Requested-With
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

plugins:
  # Global plugins
  - name: prometheus
    config:
      status_code_metrics: true
      latency_metrics: true
      bandwidth_metrics: true
      upstream_health_metrics: true

  - name: request-termination
    config:
      status_code: 503
      message: "API is temporarily unavailable"
    enabled: false

  - name: ip-restriction
    config:
      whitelist:
        - 0.0.0.0/0  # Allow all IPs for development
    enabled: false
