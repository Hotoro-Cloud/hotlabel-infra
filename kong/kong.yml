_format_version: "3.0"
_transform: true

services:
  - name: publishers-service
    url: http://publishers:8004
    routes:
      - name: publishers-api-route
        paths:
          - /api/v1/publishers
        strip_path: false
      - name: publishers-health-route
        paths:
          - /api/v1/publishers/health
        strip_path: true
      - name: publishers-docs-route
        paths:
          - /api/v1/publishers/docs
          - /api/v1/publishers/redoc
          - /api/v1/publishers/openapi.json
        strip_path: true
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
          exposed_headers:
            - X-Auth-Token
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

  - name: tasks-service
    url: http://tasks:8002
    routes:
      - name: tasks-api-route
        paths:
          - /api/v1/tasks
        strip_path: false
      - name: tasks-health-route
        paths:
          - /api/v1/tasks/health
        strip_path: true
      - name: tasks-docs-route
        paths:
          - /api/v1/tasks/docs
          - /api/v1/tasks/redoc
          - /api/v1/tasks/openapi.json
        strip_path: true
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
            - PATCH
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
            - Authorization
          exposed_headers:
            - X-Auth-Token
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

  - name: qa-service
    url: http://qa:8003
    routes:
      - name: qa-api-route
        paths:
          - /api/v1/qa
        strip_path: false
      - name: qa-health-route
        paths:
          - /api/v1/qa/health
        strip_path: true
      - name: qa-docs-route
        paths:
          - /api/v1/qa/docs
          - /api/v1/qa/redoc
          - /api/v1/qa/openapi.json
        strip_path: false
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
          exposed_headers:
            - X-Auth-Token
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

  - name: users-service
    url: http://users:8005
    routes:
      - name: users-api-route
        paths:
          - /api/v1/users
        strip_path: false
      - name: users-health-route
        paths:
          - /api/v1/users/health
        strip_path: true
      - name: users-docs-route
        paths:
          - /api/v1/users/docs
          - /api/v1/users/redoc
          - /api/v1/users/openapi.json
        strip_path: false
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
          exposed_headers:
            - X-Auth-Token
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

  - name: providers-service
    url: http://tasks:8002
    routes:
      - name: providers-api-route
        paths:
          - /api/v1/providers
        strip_path: false
      - name: providers-health-route
        paths:
          - /api/v1/providers/health
        strip_path: true
      - name: providers-docs-route
        paths:
          - /api/v1/providers/docs
          - /api/v1/providers/redoc
          - /api/v1/providers/openapi.json
        strip_path: true
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
            - Authorization
          exposed_headers:
            - X-Auth-Token
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

plugins:
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - X-Auth-Token
      exposed_headers:
        - X-Auth-Token
      credentials: true
      max_age: 3600